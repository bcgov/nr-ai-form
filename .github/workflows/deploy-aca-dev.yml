name: Deploy ACA to Dev (Not Supported)

on:
  workflow_dispatch:

jobs:
  error:
    name: Container Apps Not Supported in Dev
    runs-on: ubuntu-24.04
    steps:
      - name: Show Error Message
        run: |
          echo "‚ùå ERROR: Container Apps deployment is not supported in dev environment"
          echo ""
          echo "üìã Reason:"
          echo "  Container Apps requires a dedicated subnet with delegation to Microsoft.App/environments"
          echo "  Dev environment uses existing networking with pre-allocated subnets"
          echo "  These subnets are already in use and cannot be shared with Container Apps"
          echo ""
          echo "‚úÖ Solutions:"
          echo "  1. Use 'Deploy to Dev' workflow for App Service deployment"
          echo "  2. Test Container Apps in test/prod environments using 'Deploy ACA to Test' workflow"
          echo ""
          echo "üìö Documentation: docs/CONTAINER_APPS_NETWORKING.md"
          exit 1
        with:
          path: ~/.tflint.d/plugins
          key: ubuntu-tflint-${{ hashFiles('.tflint.hcl') }}
      
      - uses: terraform-linters/setup-tflint@v4
        name: Setup TFLint
        with:
          tflint_version: v0.52.0
      
      - name: Show version
        run: tflint --version

      - name: Init TFLint
        run: tflint --init
        env:
          GITHUB_TOKEN: ${{ github.token }}

      - name: Run TFLint
        run: tflint -f compact

  deploy-aca-dev: 
    name: Deploy Azure Container Apps to Dev
    needs: builds
    if: github.event_name == 'workflow_dispatch'    
    concurrency:
      group: deploy-aca-dev-${{ github.event.number || 'latest' }}
      cancel-in-progress: false
    uses: ./.github/workflows/.deploy_aca_stack.yml
    with:
      command: apply
      tag: dev-aca
      app_env: dev
      environment_name: dev
      deployment_type: container_apps
    secrets: inherit
